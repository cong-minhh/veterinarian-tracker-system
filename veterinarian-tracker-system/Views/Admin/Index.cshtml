@model AdminDashboardStatsDto

@{
    Layout = "_AdminLayout";
}

@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
}

<div class="container py-4">
    <h2 class="mb-4">Hi, this is Admin's Dashboard</h2>

    <div class="row g-4">
        <!-- Statistic Cards -->
        <div class="col-md-3">
            <div class="card text-white bg-primary shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Total Veterinarians</h5>
                    <p class="display-5">@Model.TotalVeterinarians</p>
                    <small class="text-white-50">Updated just now</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Total Owners</h5>
                    <p class="display-5">@Model.TotalOwners</p>
                    <small class="text-white-50">Updated just now</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Total Pets</h5>
                    <p class="display-5">@Model.TotalPets</p>
                    <small class="text-white-50">Updated just now</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-danger shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Active Appointments</h5>
                    <p class="display-5">@Model.ActiveAppointments</p>
                    <small class="text-white-50">Need attention</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-5">

        <!-- Chart 1: User Registration Chart -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header py-2">
                    <strong>User Registration Last 6 Months</strong>
                </div>
                <div class="card-body p-3" style="height: 300px;">
                    <canvas id="userRegistrationChart" style="height: 200px !important;"></canvas>
                </div>
            </div>
        </div>

        <!-- Chart 2: Pet Registration Chart -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header py-2">
                    <strong>Pet Registration Last 6 Months</strong>
                </div>
                <div class="card-body p-3" style="height: 300px;">
                    <canvas id="petRegistrationChart" style="height: 200px !important;"></canvas>
                </div>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        async function loadUserRegistrationStats() {
            try {
                const response = await fetch('/admin/GetUserRegistrationStats');
                const data = await response.json();

                const labels = data.map(item => item.month);
                const ownerData = data.map(item => item.ownerCount);
                const vetData = data.map(item => item.veterinarianCount);

                const ctx = document.getElementById('userRegistrationChart').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Owners',
                                data: ownerData,
                                borderColor: 'rgba(255, 99, 132, 1)',
                                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                                fill: true,
                                tension: 0.4,
                                pointRadius: 4
                            },
                            {
                                label: 'Veterinarians',
                                data: vetData,
                                borderColor: 'rgba(54, 162, 235, 1)',
                                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                fill: true,
                                tension: 0.4,
                                pointRadius: 4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top'
                            },
                            title: {
                                display: true,
                                text: 'User Registration (Last 6 months)'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                stepSize: 1
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading user registration stats:', error);
            }
        }
                async function loadPetRegistrationStats() {
            try {
                const response = await fetch('/admin/GetPetRegistrationStats');
                const data = await response.json();

                const labels = data.map(item => item.month);
                const petData = data.map(item => item.petCount);

                const ctx = document.getElementById('petRegistrationChart').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Pets Registered',
                                data: petData,
                                backgroundColor: 'rgba(255, 159, 64, 0.6)',
                                borderColor: 'rgba(255, 159, 64, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Pet Registration (Last 6 months)'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                stepSize: 1
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading pet registration stats:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            loadUserRegistrationStats();
            loadPetRegistrationStats(); 

        });
    </script>
}
