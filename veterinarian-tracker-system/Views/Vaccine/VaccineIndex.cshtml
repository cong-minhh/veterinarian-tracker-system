@model List<TuyetDang.MyVetTracer.Entity.Vaccine>

@{
    ViewData["Title"] = "Vaccine Index";
    Layout = "_Layout";
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
    <link rel="stylesheet" href="~/css/vaccine.css" />
}

<div class="vaccine-container fade-in">
    <div class="vaccine-header">
        <h2><i class="bi bi-shield-check"></i> Vaccines Management</h2>
        <a href="@Url.Action("Create", "Vaccine")" class="btn vaccine-btn vaccine-btn-success">
            <i class="bi bi-plus-circle"></i> Add New Vaccine
        </a>
    </div>

    <!-- Dashboard Stats -->
    <div class="vaccine-stats-container mb-4">
        <div class="row g-3">
            <div class="col-md-4">
                <div class="vaccine-stat-card bg-primary text-white">
                    <div class="vaccine-stat-icon"><i class="bi bi-shield-check"></i></div>
                    <div class="vaccine-stat-info">
                        <h3>@Model.Count</h3>
                        <p>Total Vaccines</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="vaccine-stat-card bg-success text-white">
                    <div class="vaccine-stat-icon"><i class="bi bi-calendar-check"></i></div>
                    <div class="vaccine-stat-info">
                        <h3>@Model.Count(v => v.Date.HasValue && v.Date.Value <= DateTime.Now)</h3>
                        <p>Administered</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="vaccine-stat-card bg-warning text-white">
                    <div class="vaccine-stat-icon"><i class="bi bi-calendar-plus"></i></div>
                    <div class="vaccine-stat-info">
                        <h3>@Model.Count(v => v.Date.HasValue && v.Date.Value > DateTime.Now)</h3>
                        <p>Scheduled</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="vaccine-search-container mb-4">
        <form id="filterForm" method="get" action="@Url.Action("VaccineIndex", "Vaccine")" class="row g-3">
            <div class="col-md-4">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" placeholder="Search vaccine name..." name="searchString" value="@ViewBag.CurrentFilter">
                </div>
            </div>
            <div class="col-md-3">
                <select class="form-select" name="statusFilter">
                    <option value="">All Status</option>
                    <option value="administered">Administered</option>
                    <option value="scheduled">Scheduled</option>
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn vaccine-btn vaccine-btn-primary w-100"><i class="bi bi-filter"></i> Apply</button>
            </div>
            <div class="col-md-2">
                <button type="button" id="resetFilters" class="btn vaccine-btn vaccine-btn-outline-secondary w-100"><i class="bi bi-x-circle"></i> Reset</button>
            </div>
        </form>
    </div>

    <!-- View Toggle Buttons -->
    <div class="mb-4">
        <div class="btn-group" role="group">
            <button id="cardViewBtn" type="button" class="btn vaccine-btn vaccine-btn-outline-primary active">
                <i class="bi bi-grid-3x3-gap"></i> Card View
            </button>
            <button id="tableViewBtn" type="button" class="btn vaccine-btn vaccine-btn-outline-primary">
                <i class="bi bi-table"></i> Table View
            </button>
            <button id="timelineViewBtn" type="button" class="btn vaccine-btn vaccine-btn-outline-primary">
                <i class="bi bi-calendar3-week"></i> Timeline View
            </button>
        </div>
    </div>

    <!-- Card View -->
    <div id="cardView" class="row g-4">
        @foreach (var vaccine in Model)
        {
            <div class="col-md-6 col-lg-4">
                <div class="vaccine-card">
                    <div class="vaccine-card-header">
                        <h3 class="vaccine-name">@vaccine.VacName</h3>
                        <span class="vaccine-id">#@vaccine.IdVac</span>
                    </div>
                    <div class="vaccine-card-body">
                        <div class="vaccine-info">
                            <div class="vaccine-info-item">
                                <span class="vaccine-info-label">Date:</span>
                                <span class="vaccine-info-value">@(vaccine.Date.HasValue ? vaccine.Date.Value.ToString("yyyy-MM-dd") : "Not scheduled")</span>
                            </div>
                            <div class="vaccine-info-item">
                                <span class="vaccine-info-label">Dose:</span>
                                <span class="vaccine-info-value">@vaccine.Dose</span>
                            </div>
                            <div class="vaccine-info-item">
                                <span class="vaccine-info-label">Total:</span>
                                <span class="vaccine-info-value">@vaccine.Total</span>
                            </div>
                            <div class="vaccine-info-item">
                                <span class="vaccine-info-label">Status:</span>
                                <span class="vaccine-info-value @(vaccine.Date.HasValue && vaccine.Date.Value <= DateTime.Now ? "text-success" : "text-warning")">
                                    @(vaccine.Date.HasValue && vaccine.Date.Value <= DateTime.Now ? "Administered" : "Scheduled")
                                </span>
                            </div>
                        </div>

                        <!-- Expandable Pet Section -->
                        <div class="vaccine-expandable-section">
                            <div class="vaccine-expandable-header" data-bs-toggle="collapse" data-bs-target="#petSection@(vaccine.IdVac)">
                                <span><i class="bi bi-person-badge"></i> Pet Information</span>
                                <i class="bi bi-chevron-down"></i>
                            </div>
                            <div id="petSection@(vaccine.IdVac)" class="collapse vaccine-expandable-content">
                                @if (vaccine.Pet != null)
                                {
                                    <div class="vaccine-pet-info">
                                        <div class="vaccine-avatar-container">
                                            <img src="@(string.IsNullOrEmpty(vaccine.Pet.Img) ? "/images/default-pet.png" : vaccine.Pet.Img)" 
                                                 alt="@vaccine.Pet.PetName" class="vaccine-avatar clickable-avatar">
                                        </div>
                                        <div class="vaccine-pet-details">
                                            <h4>@vaccine.Pet.PetName</h4>
                                            <p><strong>Type:</strong> @vaccine.Pet.PetType</p>
                                            <p><strong>Age:</strong> @vaccine.Pet.Age years</p>
                                            <p><strong>Weight:</strong> @vaccine.Pet.Weight kg</p>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <p>No pet information available</p>
                                }
                            </div>
                        </div>

                        <!-- Expandable Owner Section -->
                        <div class="vaccine-expandable-section">
                            <div class="vaccine-expandable-header" data-bs-toggle="collapse" data-bs-target="#ownerSection@(vaccine.IdVac)">
                                <span><i class="bi bi-person"></i> Owner Information</span>
                                <i class="bi bi-chevron-down"></i>
                            </div>
                            <div id="ownerSection@(vaccine.IdVac)" class="collapse vaccine-expandable-content">
                                @if (vaccine.Pet?.OwnerUser != null)
                                {
                                    <div class="vaccine-owner-info">
                                        <div class="vaccine-avatar-container">
                                            <img src="@(string.IsNullOrEmpty(vaccine.Pet.OwnerUser.Img) ? "/images/default-user.png" : vaccine.Pet.OwnerUser.Img)" 
                                                 alt="@vaccine.Pet.OwnerUser.FullName" class="vaccine-avatar clickable-avatar">
                                        </div>
                                        <div class="vaccine-owner-details">
                                            <h4>@vaccine.Pet.OwnerUser.FullName</h4>
                                            <p><strong>Email:</strong> @vaccine.Pet.OwnerUser.Email</p>
                                            <p><strong>PhoneNum:</strong> @vaccine.Pet.OwnerUser.PhoneNum</p>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <p>No owner information available</p>
                                }
                            </div>
                        </div>

                        <!-- Expandable Veterinarian Section -->
                        <div class="vaccine-expandable-section">
                            <div class="vaccine-expandable-header" data-bs-toggle="collapse" data-bs-target="#vetSection@(vaccine.IdVac)">
                                <span><i class="bi bi-hospital"></i> Veterinarian Information</span>
                                <i class="bi bi-chevron-down"></i>
                            </div>
                            <div id="vetSection@(vaccine.IdVac)" class="collapse vaccine-expandable-content">
                                @if (vaccine.VetUser != null)
                                {
                                    <div class="vaccine-vet-info">
                                        <div class="vaccine-avatar-container">
                                            <img src="@(string.IsNullOrEmpty(vaccine.VetUser.Img) ? "/images/default-vet.png" : vaccine.VetUser.Img)" 
                                                 alt="@vaccine.VetUser.FullName" class="vaccine-avatar clickable-avatar">
                                        </div>
                                        <div class="vaccine-vet-details">
                                            <h4>@vaccine.VetUser.FullName</h4>
                                            <p><strong>Specialty:</strong> @vaccine.VetUser.Qualification</p>
                                            <p><strong>Email:</strong> @vaccine.VetUser.Email</p>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <p>No veterinarian information available</p>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="vaccine-card-footer">
                        <div class="vaccine-created-date">Created: @vaccine.CreatedAt.ToString("MMM dd, yyyy")</div>
                        <div class="vaccine-actions">
                            <a href="@Url.Action("Edit", "Vaccine", new { id = vaccine.IdVac })" class="btn vaccine-btn vaccine-btn-sm vaccine-btn-primary">
                                <i class="bi bi-pencil"></i> Edit
                            </a>
                            <button class="btn vaccine-btn vaccine-btn-sm vaccine-btn-danger delete-vaccine" data-id="@vaccine.IdVac" data-name="@vaccine.VacName">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Table View -->
    <div id="tableView" style="display: none;">
        <div class="table-responsive">
            <table class="table table-hover vaccine-table">
                <thead class="vaccine-table-header">
                    <tr>
                        <th>Id</th>
                        <th>Vaccine Name</th>
                        <th>Date</th>
                        <th>Dose</th>
                        <th>Total</th>
                        <th>Pet</th>
                        <th>Owner</th>
                        <th>Veterinarian</th>
                        <th>Created Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
        @if (Model != null && Model.Count > 0)
        {
            foreach (var vaccine in Model)
            {
                <tr class="vaccine-table-row" data-vaccine-id="@vaccine.IdVac">
                    <td>@vaccine.IdVac</td>
                    <td>@vaccine.VacName</td>
                    <td>@(vaccine.Date.HasValue ? vaccine.Date.Value.ToString("yyyy-MM-dd") : "N/A")</td>
                    <td>@vaccine.Dose</td>
                    <td>@vaccine.Total</td>
                    <td>
                        @if (vaccine.Pet != null)
                        {
                            <div class="d-flex align-items-center">
                                <img src="@(string.IsNullOrEmpty(vaccine.Pet.Img) ? "/images/default-pet.png" : vaccine.Pet.Img)" 
                                     alt="@vaccine.Pet.PetName" class="vaccine-avatar-sm me-2 clickable-avatar">
                                <span>@vaccine.Pet.PetName</span>
                            </div>
                        }
                        else
                        {
                            <span>N/A</span>
                        }
                    </td>
                    <td>
                        @if (vaccine.Pet?.OwnerUser != null)
                        {
                            <div class="d-flex align-items-center">
                                <img src="@(string.IsNullOrEmpty(vaccine.Pet.OwnerUser.Img) ? "/images/default-user.png" : vaccine.Pet.OwnerUser.Img)" 
                                     alt="@vaccine.Pet.OwnerUser.FullName" class="vaccine-avatar-sm me-2 clickable-avatar">
                                <span>@vaccine.Pet.OwnerUser.FullName</span>
                            </div>
                        }
                        else
                        {
                            <span>N/A</span>
                        }
                    </td>
                    <td>
                        @if (vaccine.VetUser != null)
                        {
                            <div class="d-flex align-items-center">
                                <img src="@(string.IsNullOrEmpty(vaccine.VetUser.Img) ? "/images/default-vet.png" : vaccine.VetUser.Img)" 
                                     alt="@vaccine.VetUser.FullName" class="vaccine-avatar-sm me-2 clickable-avatar">
                                <span>@vaccine.VetUser.FullName</span>
                            </div>
                        }
                        else
                        {
                            <span>N/A</span>
                        }
                    </td>
                    <td>@vaccine.CreatedAt.ToString("yyyy-MM-dd")</td>
                    <td>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn vaccine-btn vaccine-btn-sm vaccine-btn-info me-1 js-toggle-row" data-vaccine-id="@vaccine.IdVac">
                                <i class="bi bi-chevron-down"></i>
                            </button>
                            <a href="@Url.Action("Edit", "Vaccine", new { id = vaccine.IdVac })" class="btn vaccine-btn vaccine-btn-sm vaccine-btn-primary">
                                <i class="bi bi-pencil"></i> Edit
                            </a>
                            <button class="btn vaccine-btn vaccine-btn-sm vaccine-btn-danger delete-vaccine" data-id="@vaccine.IdVac" data-name="@vaccine.VacName">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
                <tr id="expanded-row-@vaccine.IdVac" class="expanded-row" style="display: none;">
                    <td colspan="10">
                        <div class="expanded-content">
                            <!-- Vaccine Details Section -->
                            <div class="expanded-section">
                                <div class="section-title">
                                    <i class="bi bi-shield-plus"></i>
                                    <h5>Vaccine Details</h5>
                                </div>
                                <div class="section-content">
                                    <div class="detail-item">
                                        <span class="detail-label">Name:</span>
                                        <span class="detail-value">@vaccine.VacName</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Date:</span>
                                        <span class="detail-value">@(vaccine.Date.HasValue ? vaccine.Date.Value.ToString("yyyy-MM-dd") : "N/A")</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Dose:</span>
                                        <span class="detail-value">@vaccine.Dose</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Total:</span>
                                        <span class="detail-value">@vaccine.Total</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Created:</span>
                                        <span class="detail-value">@vaccine.CreatedAt.ToString("yyyy-MM-dd HH:mm")</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Pet Information Section -->
                            @if (vaccine.Pet != null)
                            {
                                <div class="expanded-section">
                                    <div class="section-title">
                                        <i class="bi bi-heart"></i>
                                        <h5>Pet Information</h5>
                                    </div>
                                    <div class="section-content">
                                        <div class="vaccine-pet-item" data-pet-id="@vaccine.Pet.IdPet">
                                            <div class="item-content">
                                                <div class="item-avatar">
                                                    @if (!string.IsNullOrEmpty(vaccine.Pet.Img))
                                                    {
                                                        <img src="@vaccine.Pet.Img" alt="@vaccine.Pet.PetName" />
                                                    }
                                                    else
                                                    {
                                                        <div class="default-avatar">@vaccine.Pet.PetName.Substring(0, 1).ToUpper()</div>
                                                    }
                                                </div>
                                                <div class="item-details">
                                                    <h6>@vaccine.Pet.PetName</h6>
                                                    <p>@vaccine.Pet.PetType - @vaccine.Pet.Identification</p>
                                                </div>
                                            </div>
                                            <div class="vaccine-pet-tooltip">
                                                <div class="tooltip-header">
                                                    <div class="tooltip-avatar">
                                                        @if (!string.IsNullOrEmpty(vaccine.Pet.Img))
                                                        {
                                                            <img src="@vaccine.Pet.Img" alt="@vaccine.Pet.PetName" />
                                                        }
                                                        else
                                                        {
                                                            <div class="default-avatar">@vaccine.Pet.PetName.Substring(0, 1).ToUpper()</div>
                                                        }
                                                    </div>
                                                    <div class="tooltip-title">
                                                        <h6>@vaccine.Pet.PetName</h6>
                                                        <p>@vaccine.Pet.PetType - @vaccine.Pet.Identification</p>
                                                    </div>
                                                </div>
                                                <div class="tooltip-body">
                                                    <div class="tooltip-detail">
                                                        <span class="detail-label">Age:</span>
                                                        <span class="detail-value">@vaccine.Pet.Age years</span>
                                                    </div>
                                                    <div class="tooltip-detail">
                                                        <span class="detail-label">Sex:</span>
                                                        <span class="detail-value">@vaccine.Pet.Sex</span>
                                                    </div>
                                                    <div class="tooltip-detail">
                                                        <span class="detail-label">Weight:</span>
                                                        <span class="detail-value">@vaccine.Pet.Weight kg</span>
                                                    </div>
                                                    @* @if (!string.IsNullOrEmpty(vaccine.Pet.MedicalHistory))
                                                    {
                                                        <div class="tooltip-detail">
                                                            <span class="detail-label">Medical History:</span>
                                                            <span class="detail-value">@vaccine.Pet.MedicalHistory</span>
                                                        </div>
                                                    } *@
                                                </div>
                                                <div class="tooltip-footer">
                                                    <a href="@Url.Action("Details", "Pet", new { id = vaccine.Pet.IdPet })" class="btn btn-sm btn-primary">
                                                        View Pet Details
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            <!-- Owner Information Section -->
                            @if (vaccine.Pet?.OwnerUser != null)
                            {
                                <div class="expanded-section">
                                    <div class="section-title">
                                        <i class="bi bi-person"></i>
                                        <h5>Owner Information</h5>
                                    </div>
                                    <div class="section-content">
                                        <div class="vaccine-owner-item" data-owner-id="@vaccine.Pet.OwnerUser.IdOwnerUser">
                                            <div class="item-content">
                                                <div class="item-avatar">
                                                    @if (!string.IsNullOrEmpty(vaccine.Pet.OwnerUser.Img))
                                                    {
                                                        <img src="@vaccine.Pet.OwnerUser.Img" alt="@vaccine.Pet.OwnerUser.FullName" />
                                                    }
                                                    else
                                                    {
                                                        <div class="default-avatar">@vaccine.Pet.OwnerUser.FullName.Substring(0, 1).ToUpper()</div>
                                                    }
                                                </div>
                                                <div class="item-details">
                                                    <h6>@vaccine.Pet.OwnerUser.FullName</h6>
                                                    <p>@vaccine.Pet.OwnerUser.Email</p>
                                                </div>
                                            </div>
                                            <div class="vaccine-owner-tooltip">
                                                <div class="tooltip-header">
                                                    <div class="tooltip-avatar">
                                                        @if (!string.IsNullOrEmpty(vaccine.Pet.OwnerUser.Img))
                                                        {
                                                            <img src="@vaccine.Pet.OwnerUser.Img" alt="@vaccine.Pet.OwnerUser.FullName" />
                                                        }
                                                        else
                                                        {
                                                            <div class="default-avatar">@vaccine.Pet.OwnerUser.FullName.Substring(0, 1).ToUpper()</div>
                                                        }
                                                    </div>
                                                    <div class="tooltip-title">
                                                        <h6>@vaccine.Pet.OwnerUser.FullName</h6>
                                                        <p>@vaccine.Pet.OwnerUser.Email</p>
                                                    </div>
                                                </div>
                                                <div class="tooltip-body">
                                                    <div class="tooltip-detail">
                                                        <span class="detail-label">PhoneNum:</span>
                                                        <span class="detail-value">@vaccine.Pet.OwnerUser.PhoneNum</span>
                                                    </div>
                                                    @* @if (!string.IsNullOrEmpty(vaccine.Pet.OwnerUser.Address))
                                                    {
                                                        <div class="tooltip-detail">
                                                            <span class="detail-label">Address:</span>
                                                            <span class="detail-value">@vaccine.Pet.OwnerUser.Address</span>
                                                        </div>
                                                    } *@
                                                </div>
                                                <div class="tooltip-footer">
                                                    <a href="@Url.Action("Details", "Owner", new { id = vaccine.Pet.OwnerUser.IdOwnerUser })" class="btn btn-sm btn-primary">
                                                        View Owner Details
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                            <!-- Veterinarian Information Section -->
                            @if (vaccine.VetUser != null)
                            {
                                <div class="expanded-section">
                                    <div class="section-title">
                                        <i class="bi bi-person-badge"></i>
                                        <h5>Veterinarian Information</h5>
                                    </div>
                                    <div class="section-content">
                                        <div class="vaccine-veterinarian-item" data-vet-id="@vaccine.VetUser.IdVetUser">
                                            <div class="item-content">
                                                <div class="item-avatar">
                                                    @if (!string.IsNullOrEmpty(vaccine.VetUser.Img))
                                                    {
                                                        <img src="@vaccine.VetUser.Img" alt="@vaccine.VetUser.FullName" />
                                                    }
                                                    else
                                                    {
                                                        <div class="default-avatar">@vaccine.VetUser.FullName.Substring(0, 1).ToUpper()</div>
                                                    }
                                                </div>
                                                <div class="item-details">
                                                    <h6>@vaccine.VetUser.FullName</h6>
                                                    <p>@vaccine.VetUser.Email</p>
                                                </div>
                                            </div>
                                            <div class="vaccine-veterinarian-tooltip">
                                                <div class="tooltip-header">
                                                    <div class="tooltip-avatar">
                                                        @if (!string.IsNullOrEmpty(vaccine.VetUser.Img))
                                                        {
                                                            <img src="@vaccine.VetUser.Img" alt="@vaccine.VetUser.FullName" />
                                                        }
                                                        else
                                                        {
                                                            <div class="default-avatar">@vaccine.VetUser.FullName.Substring(0, 1).ToUpper()</div>
                                                        }
                                                    </div>
                                                    <div class="tooltip-title">
                                                        <h6>@vaccine.VetUser.FullName</h6>
                                                        <p>@vaccine.VetUser.Email</p>
                                                    </div>
                                                </div>
                                                <div class="tooltip-body">
                                                    <div class="tooltip-detail">
                                                        <span class="detail-label">PhoneNum:</span>
                                                        <span class="detail-value">@vaccine.VetUser.PhoneNum</span>
                                                    </div>
                                                    @if (!string.IsNullOrEmpty(vaccine.VetUser.Qualification))
                                                    {
                                                        <div class="tooltip-detail">
                                                            <span class="detail-label">Qualification:</span>
                                                            <span class="detail-value">@vaccine.VetUser.Qualification</span>
                                                        </div>
                                                    }
                                                </div>
                                                <div class="tooltip-footer">
                                                    <a href="@Url.Action("Details", "Veterinarian", new { id = vaccine.VetUser.IdVetUser })" class="btn btn-sm btn-primary">
                                                        View Veterinarian Details
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="10" class="text-center">No vaccines found.</td>
            </tr>
        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Timeline View -->
        <div id="timelineView" style="display: none;">
            <div class="vaccine-timeline-container">
                <div class="vaccine-timeline">
                    @{
                        var groupedVaccines = Model.OrderBy(v => v.Date).GroupBy(v => v.Date?.ToString("yyyy-MM") ?? "Unscheduled");
                    }
                    @foreach (var group in groupedVaccines)
                    {
                        <div class="vaccine-timeline-month">
                            <div class="vaccine-timeline-month-header">
                                @if (group.Key == "Unscheduled")
                                {
                                    <h3>Unscheduled</h3>
                                }
                                else
                                {
                                    <h3>@DateTime.ParseExact(group.Key, "yyyy-MM", null).ToString("MMMM yyyy")</h3>
                                }
                                <span class="vaccine-timeline-count">@group.Count() vaccines</span>
                            </div>
                            <div class="vaccine-timeline-items">
                                @foreach (var vaccine in group)
                                {
                                    <div class="vaccine-timeline-item @(vaccine.Date.HasValue && vaccine.Date.Value <= DateTime.Now ? "administered" : "scheduled")">
                                        <div class="vaccine-timeline-date">
                                            @if (vaccine.Date.HasValue)
                                            {
                                                <span>@vaccine.Date.Value.ToString("dd")</span>
                                                <small>@vaccine.Date.Value.ToString("ddd")</small>
                                            }
                                            else
                                            {
                                                <span>--</span>
                                                <small>N/A</small>
                                            }
                                        </div>
                                        <div class="vaccine-timeline-content">
                                            <div class="vaccine-timeline-header">
                                                <h4>@vaccine.VacName</h4>
                                                <span class="vaccine-timeline-status">
                                                    @(vaccine.Date.HasValue && vaccine.Date.Value <= DateTime.Now ? "Administered" : "Scheduled")
                                                </span>
                                            </div>
                                            <div class="vaccine-timeline-details">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <p><strong>Dose:</strong> @vaccine.Dose</p>
                                                        <p><strong>Total:</strong> @vaccine.Total</p>
                                                    </div>
                                                    <div class="col-md-4">
                                                        @if (vaccine.Pet != null)
                                                        {
                                                            <p>
                                                                <strong>Pet:</strong>
                                                                <img src="@(string.IsNullOrEmpty(vaccine.Pet.Img) ? "/images/default-pet.png" : vaccine.Pet.Img)" 
                                                                     alt="@vaccine.Pet.PetName" class="vaccine-avatar-xs me-1 clickable-avatar">
                                                                @vaccine.Pet.PetName
                                                            </p>
                                                        }
                                                        @if (vaccine.Pet?.OwnerUser != null)
                                                        {
                                                            <p>
                                                                <strong>Owner:</strong>
                                                                <img src="@(string.IsNullOrEmpty(vaccine.Pet.OwnerUser.Img) ? "/images/default-user.png" : vaccine.Pet.OwnerUser.Img)" 
                                                                     alt="@vaccine.Pet.OwnerUser.FullName" class="vaccine-avatar-xs me-1 clickable-avatar">
                                                                @vaccine.Pet.OwnerUser.FullName
                                                            </p>
                                                        }
                                                    </div>
                                                    <div class="col-md-4">
                                                        @if (vaccine.VetUser != null)
                                                        {
                                                            <p>
                                                                <strong>Veterinarian:</strong>
                                                                <img src="@(string.IsNullOrEmpty(vaccine.VetUser.Img) ? "/images/default-vet.png" : vaccine.VetUser.Img)" 
                                                                     alt="@vaccine.VetUser.FullName" class="vaccine-avatar-xs me-1 clickable-avatar">
                                                                @vaccine.VetUser.FullName
                                                            </p>
                                                        }
                                                        <p><strong>Created:</strong> @vaccine.CreatedAt.ToString("yyyy-MM-dd")</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="vaccine-timeline-actions">
                                                <a href="@Url.Action("Edit", "Vaccine", new { id = vaccine.IdVac })" class="btn vaccine-btn vaccine-btn-sm vaccine-btn-primary">
                                                    <i class="bi bi-pencil"></i> Edit
                                                </a>
                                                <button class="btn vaccine-btn vaccine-btn-sm vaccine-btn-danger delete-vaccine" data-id="@vaccine.IdVac" data-name="@vaccine.VacName">
                                                    <i class="bi bi-trash"></i> Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success Message Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
    <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                <i class="bi bi-check-circle me-2"></i> <span id="toastMessage">@(TempData["SuccessMessage"] ?? "Operation completed successfully!")</span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmationModalLabel"><i class="bi bi-exclamation-triangle"></i> Confirm Deletion</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete the vaccine <strong id="vaccineNameToDelete"></strong>?</p>
                <p class="text-danger"><small>This action cannot be undone.</small></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="#" id="confirmDeleteBtn" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>

<!-- Img Modal -->
<div class="modal fade" id="avatarModal" tabindex="-1" aria-labelledby="avatarModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="avatarModalLabel">Profile Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modalAvatarImg" src="" alt="Profile Image" class="img-fluid rounded">
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="~/js/vaccine.js"></script>
}